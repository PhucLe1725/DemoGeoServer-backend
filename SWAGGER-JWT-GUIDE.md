# ?? Swagger JWT Authentication Guide

## ? ?ã C?u Hình Swagger H? Tr? JWT

Swagger UI gi? ?ã có nút **"Authorize"** ?? nh?p JWT token!

## ?? Cách S? D?ng

### B??c 1: Ch?y Application
```bash
cd DemoGeoServer
dotnet run
```

### B??c 2: M? Swagger UI
Truy c?p: `http://localhost:5148/swagger`

### B??c 3: ??ng Ký User (Không c?n token)
1. M? endpoint **POST** `/api/auth/register`
2. Click **"Try it out"**
3. Nh?p thông tin:
```json
{
  "username": "admin",
  "password": "password123",
  "email": "admin@demo.com",
  "role": "Admin"
}
```
4. Click **"Execute"**
5. K?t qu? (không có token):
```json
{
"success": true,
  "message": "Registration successful. Please login to continue.",
  "userId": 1,
  "username": "admin",
  "email": "admin@demo.com"
}
```

### B??c 4: ??ng Nh?p ?? L?y Token
1. M? endpoint **POST** `/api/auth/login`
2. Click **"Try it out"**
3. Nh?p credentials:
```json
{
  "username": "admin",
  "password": "password123"
}
```
4. Click **"Execute"**
5. **Copy token** t? response:
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwidW5pcXVlX25hbWUiOiJhZG1pbiIsImVtYWlsIjoiYWRtaW5AZGVtby5jb20iLCJqdGkiOiJhYmMxMjMiLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL25hbWVpZGVudGlmaWVyIjoiMSIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL25hbWUiOiJhZG1pbiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL2VtYWlsYWRkcmVzcyI6ImFkbWluQGRlbW8uY29tIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjoiQWRtaW4iLCJleHAiOjE3Mzc5MDg0MDAsImlzcyI6IkRlbW9HZW9TZXJ2ZXIiLCJhdWQiOiJEZW1vR2VvU2VydmVyVXNlcnMifQ...",
  "refreshToken": "base64_string...",
  "expiresAt": "2025-01-26T12:00:00Z",
  "message": "Login successful"
}
```

### B??c 5: ?? Authorize trong Swagger

1. **Click nút "Authorize"** ? góc trên bên ph?i (bi?u t??ng ? khóa)
2. M?t popup s? hi?n ra
3. **Paste token** vào ô "Value" (ch? paste token, không c?n thêm "Bearer")
4. Click **"Authorize"**
5. Click **"Close"**

![Swagger Authorize Button](https://i.imgur.com/authorize-btn.png)

### B??c 6: Test Protected Endpoints

#### Test Public Endpoint (Không c?n token)
1. M? **GET** `/api/test/public`
2. Click "Try it out" ? "Execute"
3. ? S? tr? v? 200 OK

#### Test Protected Endpoint (C?n token)
1. M? **GET** `/api/test/protected`
2. Endpoint này có bi?u t??ng ? khóa ??
3. Click "Try it out" ? "Execute"
4. ? N?u ?ã authorize: 200 OK v?i user info
5. ? N?u ch?a authorize: 401 Unauthorized

#### Test Admin Endpoint (C?n Admin role)
1. M? **GET** `/api/test/admin`
2. Click "Try it out" ? "Execute"
3. ? N?u user có role "Admin": 200 OK
4. ? N?u không ph?i Admin: 403 Forbidden

## ?? Visual Guide

### Swagger UI v?i JWT Authorization

```
???????????????????????????????????????????????????????????
?  DemoGeoServer API  v1      [Authorize ??]  ? Click here?
???????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????
? Available authorizations          ?
? ????????????????????????????????????????????????????????
? ? Bearer (http, Bearer)??
? ?     ??
? ? Value:         ??
? ? ??????????????????????????????????????????????????????
? ? ? eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...         ??? ? Paste token
? ? ??????????????????????????????????????????????????????
? ?           ??
? ?        [Authorize]  [Close]         ??
? ????????????????????????????????????????????????????????
???????????????????????????????????????????????????????????
```

### Sau khi Authorize

```
???????????????????????????????????????????????????????????
?  DemoGeoServer API  v1      [Authorize ??]  ? Locked    ?
???????????????????????????????????????????????????????????

Auth Controller
  ? POST /api/auth/register
  ? POST /api/auth/login
  ? POST /api/auth/refresh
  ? POST /api/auth/logout/{userId}

Test Controller
  ? GET /api/test/public  (no lock)
  ?? GET /api/test/protected        (locked - requires auth)
  ?? GET /api/test/admin            (locked - requires admin)
```

## ?? Troubleshooting

### L?i: 401 Unauthorized
**Nguyên nhân:**
- Ch?a authorize trong Swagger
- Token ?ã h?t h?n (60 phút)
- Token không h?p l?

**Gi?i pháp:**
1. Click nút "Authorize"
2. Paste token m?i (login l?i n?u c?n)
3. Click "Authorize" ? "Close"
4. Th? l?i request

### L?i: 403 Forbidden
**Nguyên nhân:**
- Token h?p l? nh?ng user không có quy?n (role)
- Endpoint yêu c?u Admin role nh?ng user là "User"

**Gi?i pháp:**
- ??ng ký user v?i role "Admin"
- Ho?c test v?i endpoint phù h?p v?i role c?a user

### Token H?t H?n
**Tri?u ch?ng:**
- Tr??c ?ó test OK, gi? 401 Unauthorized
- Token ?ã ???c s? d?ng > 60 phút

**Gi?i pháp:**
1. G?i **POST** `/api/auth/refresh` v?i refresh token
2. Ho?c login l?i ?? l?y token m?i
3. Re-authorize trong Swagger v?i token m?i

### Logout
**L?u ý:**
- Sau khi logout, click nút "Authorize" ??
- Click **"Logout"** trong popup
- ?i?u này xóa token kh?i Swagger UI

## ?? Checklist

Khi test v?i Swagger:

- [ ] ?ã ch?y app: `dotnet run`
- [ ] ?ã m? Swagger: `http://localhost:5148/swagger`
- [ ] ?ã register user
- [ ] ?ã login và copy token
- [ ] ?ã click "Authorize" và paste token
- [ ] Test public endpoint (không c?n auth)
- [ ] Test protected endpoint (c?n auth)
- [ ] Test admin endpoint (c?n admin role)

## ?? Best Practices

1. **Luôn logout** tr??c khi ?óng Swagger ?? xóa token
2. **Refresh token** khi g?n h?t h?n (< 5 phút)
3. **??ng share token** qua chat/email
4. **Test v?i nhi?u roles** khác nhau
5. **Verify expiration time** trong response

## ?? Related Endpoints

| Endpoint | Purpose | Token Required |
|----------|---------|----------------|
| POST `/api/auth/register` | T?o tài kho?n m?i | ? |
| POST `/api/auth/login` | L?y token | ? |
| POST `/api/auth/refresh` | Làm m?i token | ? (c?n refresh token) |
| POST `/api/auth/logout/{userId}` | ??ng xu?t | ? |
| GET `/api/test/public` | Test public | ? |
| GET `/api/test/protected` | Test authenticated | ? |
| GET `/api/test/admin` | Test admin role | ? (Admin only) |

## ?? Tips

- **Copy token** ngay sau login
- **Dùng Postman** ho?c `.http` file ?? l?u token
- **Set timer** ?? nh? refresh token tr??c khi h?t h?n
- **Test logout** ?? verify refresh tokens b? xóa

---

**Swagger UI Location:** `http://localhost:5148/swagger`  
**JWT Token Lifetime:** 60 minutes  
**Refresh Token Lifetime:** 7 days
